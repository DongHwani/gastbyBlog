---
title: TCP 핸드쉐이크 (작성중)
date: 2021-04-15
tags:
  - Network
---  

TCP는 연결지향 프로토콜이다. 양 종단간의 논리적으로 접속 가능한 상태로 만든 뒤 서버와 클라이언트는
지속적인 통신을 할 수 있게 된다. 

해당 포스트에서는 TCP의 `접속가능상태`로 만드는 3way handshake와 `접속 종료`로 만드는 4way handshake에 대해
살펴보고, 이 과정을 통해 TCP가 의미하는 `연결지향 프로토콜`이 무엇인지 알아보도록 하겠다. 

##### 3way Handshake 과정

클라이언트와 서버간의 접속가능 상태를 만들기 위해서 서버와 클라이언트는 3way 핸드쉐이크 과정을 거친다. 핸드쉐이크 과정을 
거치기전에 우선 클라이언트는 서버의 IP주소를 알아야 핸드쉐이크 요청이 가능하다.  

클라이언트는 DNS 서버를 통해 IP주소를 조회하고 클라이언트의 TCP Header에 송,수신처에 대한 IP와 포트번호 값을 넣음으로써, 
3way 핸드쉐이크 과정을 시작할 준비단계를 마친다.  

이제 어떻게 서버와 클라이언트간의 3way 핸드쉐이크 과정이 진행되는지 살펴보겠다. 

![3way-handshake](../network-handshake/3way-handshake.png)

1) 클라이언트는 서버로 난수인 SYN 비트를 보낸다.  
2) 서버는 클라이언트로 받은 SYN비트에 1을 더한 승인비트인 ACK비트와 또 다른 난수인 SYN 비트를 클라이언트에게 보낸다.    
3) 클라이언트는 서버로부터 받은 SYN비트에 1을 더한 ACK비트를 서버로 보내주, 연결 가능한 상태가 되면서 데이터 전송 프로세스가 시작된다.

`SYN` 비트는 시퀀스 번호의 동기화를 의미한다. 요청자가 SYN 비트를 송신후 승인이 수신되지 않을 경우, 지정한 횟수만큼 
승인비트가 수신될때까지 재전송한다. 

`SYN` 비트는 난수를 사용하게 되는데, 커넥션을 맺을 때 사용하는 포트는 한정된 범위 내에서 사용하고 시간이 지남에 따라 재사용하게 되어있다.
따라서 두 통신 호스트가 과거에 사용된 포트 번호 쌍을 사용하는 가능성이 존재한다. 
서버 측에서는 패킷의 SYN을 보고 패킷을 구분하게 되는데 난수가 아닌 순차적인 숫자가 전송된다면 이전의 
connection으로부터 오는 패킷으로 인식될 수 있어 랜덤값인 난수를 사용한다.

##### 4way 핸드쉐이크 과정

[Refference]
- 성공과 실패를 결정하는 1%의 네트워크 원리
- https://tools.ietf.org/html/rfc793#section-3.1
- https://dev.to/snj/tcp-3-way-handshake-in-detail-eao

